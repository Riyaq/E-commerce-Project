
1. Query:List all unique cities where customer are located.

```sql
select distinct customer_city from customers;
```
----------------------------------------------------------------------------------------------------------------------
2. Query: Count number of customer from each city

```sql
SELECT distinct customer_city City, count(customer_city) Customer_count  from oldcustomers group by City;
```
----------------------------------------------------------------------------------------------------------------------
3. Query: Count the number of orders placed in 2017

```sql
select count(order_id) from orders where year(order_purchase_timestamp)=2017;
```
----------------------------------------------------------------------------------------------------------------------
4. Find the total sale per category

 -Products --> Product_category , Product_id<br>
 -Payments --> Payment_value , order_id<br>
 -Order_itmes --> Product_id , order_id<br>

```sql
SELECT products.product_category category, round(sum(payments.payment_value),2)  sales
from products
join order_items
on 
products.Product_id=order_items.Product_id
join payments
on payments.order_id=order_items.order_id
group by category;
```
----------------------------------------------------------------------------------------------------------------------
5. Calculate total percentage of orders that were paid in installments.

```sql
SELECT (sum(case when payment_installments>=1 then 1 else 0 end))/count(*)*100 from payments
```

----------------------------------------------------------------------------------------------------------------------

6. Count the number of customer from each state
```sql
SELECT customer_state, count(customer_id) from  oldcustomers group by customer_state;"""
```


#Using matploblib here<br>

import matplotlib.pyplot as plt
query = """ SELECT customer_state, count(customer_id) from  oldcustomers group by customer_state; """
cur.execute(query)
data = cur.fetchall()
df=pd.DataFrame(data, columns = ["State","Customer_count"])
df=df.sort_values(by= "Customer_count", ascending=False)
plt.figure(figsize=(8,3))
plt.bar(df["State"],df["Customer_count"])
plt.xticks(rotation=90)
plt.show()



----------------------------------------------------------------------------------------------------------------------

7. Calculate number of orders per month in the year 2018
```sql
Select monthname(order_purchase_timestamp) month, count(order_id) order_count from orders
where year(order_purchase_timestamp) = 2018
group by month;
```
#USING BAR GRAPH<br>
plt.bar(df["Month"],df["Order_count"])
plt.show()


----------------------------------------------------------------------------------------------------------------------
8. Find the average number of products per order, grouped by customer city.

 -oldcustomers table -> Customer_id , Customer_city<br>
 -order_items table -> order_id , Order_item_id<br>
 -orders table -> order_id , Customer_id<br>



#Creating a table to store output of first query named as - count_per_order
```sql
with count_per_order as 
(select orders.order_id, orders.customer_id, count(order_items.order_id) as oc
from orders join order_items
on orders.order_id = order_items.order_id
group by orders.order_id, orders.customer_id)

select oldcustomers.customer_city, round(avg(count_per_order.oc),2) average_orders
from oldcustomers join count_per_order
on oldcustomers.customer_id = count_per_order.customer_id
group by oldcustomers.customer_city order by average_orders desc
```
----------------------------------------------------------------------------------------------------------------------
9. Calculate the percentage of total revenue contributed by each product category.

 -Payments table -> order_id , payment_value<br>
 -Products table -> product_id , product_category<br>
 -order_items table -> order_id ,product_id<br>

I need two row -> Product_category , Revenue_distribution
```sql
SELECT upper(products.product_category) category, round((sum(payments.payment_value)/(select sum(Payment_value) from Payments))*100,2)  percentage_distribution
from products
join order_items
on 
products.Product_id=order_items.Product_id
join payments
on payments.order_id=order_items.order_id
group by category order by percentage_distribution desc ;
```

----------------------------------------------------------------------------------------------------------------------

10. Calculate the total revenue generated by each seller, and rank them by revenue.


 -Payments table -> order_id , payment_value<br>
 -Sellers table -> Seller_id<br>
 -order_items table -> order_id ,Seller_id<br>
```sql
select Sellers.Seller_id , round(sum(payments.payment_value),2) Revenue
from payments join order_items
on payments.order_id=order_items.order_id
join Sellers 
on Sellers.Seller_id=order_items.Seller_id
group by Seller_id order by Revenue desc;
```

